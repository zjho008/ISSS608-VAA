{
  "hash": "cbeee428a79976ea35a3738ef6917abd",
  "result": {
    "markdown": "---\ntitle: \"In-class Exercise 6a\"\nauthor: \"Ho Zi Jun\"\ndate: \"May 18, 2024\"\ndate-modified: \"last-modified\"\nexecute:\n  eval: true\n  echo: true\n  warning: false\n  freeze: true\n  format: html\neditor: visual\n---\n\n\n## [6.0]{style=\"colour:grey\"} Exploring the King James Bible\n\n**corporaexplorer** can be used to explore not only chronological text collections with documen *date* as main organising principle, but any collection of texts. The example used here is the [King James Bible](https://en.wikipedia.org/wiki/King_James_Version).\n\n## [6.1]{style=\"colour:grey\"} Loading the necessary R packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, readtext, corporaexplorer,\n               quanteda, stringi, stringr, rvest, tidytext)\n```\n:::\n\n\n## [6.2]{style=\"colour:grey\"} Loading the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbible <- readr::read_lines(\"http://www.gutenberg.org/cache/epub/10/pg10.txt\")\n```\n:::\n\n\nthe data is a text file; a plain text from a website\n\n## [6.3]{style=\"colour:grey\"} Tidying up the text\n\n### [6.3.1]{style=\"colour:grey\"} Pre-processing the text\n\n#### Collapsing into one string.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbible <- paste(bible, collapse = \"\\n\")\n```\n:::\n\n\n#### Identifying the beginning and end of the Bible / stripping PJ metadata\n\n::: callout-note\ntechnique borrowed from - [https://quanteda.io/articles/pkgdown/replication/digital-humanities.html](https://quanteda.io/articles/pkgdown/replication/digital-humanities.html).\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstart_v <- stri_locate_first_fixed(bible, \"The First Book of Moses: Called Genesis\")[1]\nend_v <- stri_locate_last_fixed(bible, \"Amen.\")[2]\nbible <- stri_sub(bible, start_v, end_v)\n```\n:::\n\n\n#### In the file, every book in the bible is preceded by five newlines,\n\nwhich we use to split our string into a vector where each element is a book.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbooks <- stri_split_regex(bible, \"\\n{5}\") %>%\n    unlist %>%\n    .[-40] # Removing the heading \"The New Testament of the King James Bible\",\n              # which also was preceded by five newlines.\n```\n:::\n\n\n#### Because of the structure of the text in the file:\n\nReplacing double or more newlines with two newlines, and a single newline with space.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbooks <- str_replace_all(books, \"\\n{2,}\", \"NEW_PARAGRAPH\") %>%\n    str_replace_all(\"\\n\", \" \") %>%\n    str_replace_all(\"NEW_PARAGRAPH\", \"\\n\\n\")\nbooks <- books[3:68]  # The two first elements are not books\n```\n:::\n\n\n#### Identifying new chapters within each book and split the text into chapters.\n\nE.g. (The first characters in chapter 2 will e.g. be 2:1)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchapters <- str_replace_all(books, \"(\\\\d+:1 )\", \"NEW_CHAPTER\\\\1\") %>%\n    stri_split_regex(\"NEW_CHAPTER\")\n```\n:::\n\n\n#### Removing the chapter headings from the text (we want them as metadata).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchapters <- lapply(chapters, function(x) x[-1])\n```\n:::\n\n\n## [6.4]{style=\"colour:grey\"} Metadata\n\nWe are not quite happy with the long book titles in the King James Bible, so we retrieve shorter versions from esv.org which will take up less space in the corpus map plot.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbook_titles <- read_html(\"https://www.esv.org/resources/esv-global-study-bible/list-of-abbreviations\") %>%\n  html_nodes(\"td:nth-child(1)\") %>%\n  html_text() %>%\n  .[13:78]  # Removing irrelevant elements after manual inspection.\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# We add a column indicating whether a book belongs to the Old or New Testament,\n#   knowing that they contain respectively 39 and 27 books.\ntestament <- c(rep(\"Old\", 39), rep(\"New\", 27))\n```\n:::\n\n\n## [6.5]{style=\"colour:grey\"} Creating data frame with text and metadata\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Data frame with one book as one row.\nbible_df <- tibble::tibble(Text = chapters,\n                           Book = book_titles,\n                           Testament = testament)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# We want each chapter to be one row, but keep the metadata (book and which testament).\nbible_df <- tidyr::unnest(bible_df, Text)\n```\n:::\n\n\n## [6.6]{style=\"colour:grey\"} Using corporaexplorer\n\n#### As this is a corpus which is not organised by date,\n\n::: callout-note\n1.  we set `date_based_corpus` to `FALSE`.\n2.  Because we want to organise our exploration around the books in the Bible,\n3.  we pass `\"Book\"` to the `grouping_variable` argument.\n4.  We specify which metadata columns we want to be displayed in the: \"Document information\" tab, using the `columns_doc_info` argument.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nKJB <- prepare_data(dataset = bible_df,\n                    date_based_corpus = FALSE,\n                    grouping_variable = \"Book\",\n                    columns_doc_info =\nc(\"Testament\", \"Book\"))  #that helps group together the one that we are extracting\n# a unique object class is created that R Studio can read\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nclass(KJB) #to check that the object class is created properly since it is specially catered to corpora explorer\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"corporaexplorerobject\"\n```\n:::\n:::\n\n\nFrom the class function it shows that the object class is a \"corporaexplorerobject\" to show that we are on the right track.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexplore(KJB) #pull up the shiny app\n```\n\n::: {.cell-output-display}\n`<div style=\"width: 100% ; height: 400px ; text-align: center; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box;\" class=\"muted well\">Shiny applications not supported in static R Markdown documents</div>`{=html}\n:::\n:::\n\n\nSnapshots of corpus exploration tool\n\n![](corpus1.png) ![](corpus2.png) ![](corpus3.png) ![](corpus4.png)\n\n::: callout-tip\n## Steps/processes for this exercise\n\n-   Preparing and then tidying up the data (working with text data instead of usual numerical data)\n-   Constructing the data frame\n-   Exploration of the data\n:::\n\n## [6.7]{style=\"colour:grey\"} References\n\n[Exploring the King James Bible](https://kgjerde.github.io/corporaexplorer/articles/bible.html)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}