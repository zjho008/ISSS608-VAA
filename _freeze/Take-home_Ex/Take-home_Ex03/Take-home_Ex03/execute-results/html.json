{
  "hash": "8021252e7f7f2210d5cbc93405fe18ce",
  "result": {
    "markdown": "---\ntitle: \"Take-home Exercise 3: Network Data Visualisation and Analysis\"\nauthor: \"Ho Zi Jun\"\ndate: \"June 2, 2024\"\ndate-modified: \"last-modified\"\nformat:\n  html:\n    code-fold: true\n    code-summary: \"The code chunk\"\n    number-sections: true\nexecute:\n  eval: true\n  echo: true\n  warning: false\n  freeze: true\n  message: false\neditor: source\n---\n\n\n## Overview - VAST Challenge: Mini-Challenge 3\n\n### Background\n\nOceanus has a dynamic business landscape with frequent startups, mergers, acquisitions and investments. FishEye International monitors commercial fishing operators to prevent illegal fishing in the region's sensitive marine ecosystem. Analysts use a hybrid automated/manual process to transform company records into CatchNet: the Oceanus Knowledge Graph.\n\nLast year, SouthSeafood Express Corp was caught fishing illegally, disrupting the commercial fishing sector. FishEye aims to analyze the temporal patterns and impacts of this incident on the fishing market. The competitive nature of the market might lead some businesses to seize SouthSeafood's market share, while others may recognize the consequences of illegal fishing.\n\n## Project Objectives\n\nThe project will focus on 2 out of the 4 tasks from VAST Challenge 2024: [Mini-Challenge 3](https://vast-challenge.github.io/2024/MC3.html)\n\nThis study aims to develop visualisation tools that work with CatchNet to identify the people who hold influence over business networks and hold those who own nefarious companies accountable. That is especially difficult with varied and changing shareholder and ownership relationships. The tasks are:\n\n1.  **Develop a visual approach to examine inferences**. Infer how the influence of a company changes through time. Can we infer ownership or influence that a network may have?\n2.  Identify the network associated with SouthSeafood Express Corp and visualize how this network and competing businesses change as a result of their illegal fishing behavior. Which companies benefited from SouthSeafood Express Corp legal troubles? Are there other suspicious transactions that may be related to illegal fishing? Providing visual evidence for the conclusions.\n\n### Loading R packages\n\nIn this hands-on exercise, **four** network data modelling and visualisation packages will be installed and launched. They are *igraph*, *tidygraph*, *ggraph* and *visNetwork*. Beside these four packages, *tidyverse*, *lubridate*, *clock* and *graphlayouts* will be installed and launched too.\n\n| Packages                                                                                                     | Description                                                                                                                                            |\n|:-----------------------------|:-----------------------------------------|\n| jsonlite                                                                                                     |                                                                                                                                                        |\n| [*tidygraph*](https://cran.r-project.org/web/packages/tidygraph/index.html)                                  | A Tidy API for Graph Manipulation                                                                                                                      |\n| [*ggraph*](https://cran.r-project.org/web/packages/ggraph/index.html)                                        | an extension of the ggplot2 API tailored to graph visualizations and provides the same flexible approach to building up plots layer by layer           |\n| [*igraph*](https://r.igraph.org/)                                                                            | For Network Analysis and Visualization                                                                                                                 |\n| [*visNetwork*](https://cran.r-project.org/web/packages/visNetwork/vignettes/Introduction-to-visNetwork.html) | a R package for network visualization, using vis.js javascript library (https://visjs.org)                                                             |\n| [*tidyverse*](https://www.tidyverse.org/)                                                                    | a family of modern R packages specially designed to support data science, analysis and communication task including creating static statistical graphs |\n| tidytext                                                                                                     |                                                                                                                                                        |\n| skimr                                                                                                        |                                                                                                                                                        |\n| DT                                                                                                           |                                                                                                                                                        |\n| [*lubridate*](https://lubridate.tidyverse.org/)                                                              | an R package specially designed to handle and wrangle time data                                                                                        |\n| plotly                                                                                                       |                                                                                                                                                        |\n| [*clock*](https://www.tidyverse.org/blog/2021/03/clock-0-1-0/)                                               | package providing a comprehensive set of tools for working with date-times                                                                             |\n| [*graphlayouts*](https://cran.r-project.org/web/packages/graphlayouts/vignettes/graphlayouts.html)           | package implements some graph layout algorithms that are not available in `igraph` or other packages                                                   |\n\n: R Packages {.striped .hover tbl-colwidths=\"\\[25,75\\]\"}\n\nThe code chunk:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(jsonlite, tidygraph, ggraph, igraph,\n               visNetwork, tidyverse, tidytext, skimr,\n               DT, lubridate, plotly, clock, graphlayouts)\n```\n:::\n\n\n## The Data\n\nIn the code chunk below, fromJSON() of jsonlite package is used to import MC3.json file into the R environment.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc3 <- fromJSON(\"data/MC3/mc3.json\")\n```\n:::\n\n\nInitially, when trying to load the mc3.json data we faced an error message regarding a NaN issue.\n\n![Error message](error.png) Hence we converted solely the NaN fields to \"NaN\" to curb this issue and the mc3.json file is imported successfully.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass(mc3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"list\"\n```\n:::\n:::\n\nThe output is called mc3. It is a large list R object. There are two data sets. One contains the nodes data and the other contains the edges (also know as link) data.\n\n## Wrangling and tidying edges\n\nIn this section, we will extract and wrangle the edges object.\n\n### Extracting the edges data\n\nThe code chunk below will be used to extract the *links* data.frame of *mc3* and saves it as a tibble data.frame called *mc3_edges*.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc3_edges <- as_tibble(mc3$links) %>%\n  distinct() #to avoid duplicate records; source,target,type if they are the same will be treated as duplicates and kept as one\n```\n:::\n\n\nglimpse() of dplyr will be used to reveal the structure of mc3_edges tibble data.table\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(mc3_edges)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 75,817\nColumns: 11\n$ start_date          <chr> \"2016-10-29T00:00:00\", \"2035-06-03T00:00:00\", \"202…\n$ type                <chr> \"Event.Owns.Shareholdership\", \"Event.Owns.Sharehol…\n$ `_last_edited_by`   <chr> \"Pelagia Alethea Mordoch\", \"Niklaus Oberon\", \"Pela…\n$ `_last_edited_date` <chr> \"2035-01-01T00:00:00\", \"2035-07-15T00:00:00\", \"203…\n$ `_date_added`       <chr> \"2035-01-01T00:00:00\", \"2035-07-15T00:00:00\", \"203…\n$ `_raw_source`       <chr> \"Existing Corporate Structure Data\", \"Oceanus Corp…\n$ `_algorithm`        <chr> \"Automatic Import\", \"Manual Entry\", \"Automatic Imp…\n$ source              <chr> \"Avery Inc\", \"Berger-Hayes\", \"Bowers Group\", \"Bowm…\n$ target              <chr> \"Allen, Nichols and Thompson\", \"Jensen, Morris and…\n$ key                 <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ end_date            <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n```\n:::\n:::\n\n::: callout-note\n## Identified issues from the table above\n-  columns with date data type are not in the correct format\n-  some field names(for e.g `_last_edited_by`) start with \"_\" and will have to be renamed to avoid unnecessary coding issues in the later part of the tasks.\n:::\n\n### Correcting the date data type\nThe code chunk below uses as_datetime() of the **lubridate** package to convert fields with character date into **POSIXt** format.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc3_edges$\"start_date\" <- as_datetime(mc3_edges$start_date)\nmc3_edges$\"_last_edited_date\" <- as_datetime(mc3_edges$\"_last_edited_date\")\nmc3_edges$\"_date_added\" <- as_datetime(mc3_edges$\"_date_added\")\nmc3_edges$\"end_date\" <- as_datetime(\"mc3_edges$end_date\")\n```\n:::\n\nNext, glimpse() function will be used to confirm if the process have been performed correctly.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(mc3_edges)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 75,817\nColumns: 11\n$ start_date          <dttm> 2016-10-29, 2035-06-03, 2028-11-20, 2024-09-04, 2…\n$ type                <chr> \"Event.Owns.Shareholdership\", \"Event.Owns.Sharehol…\n$ `_last_edited_by`   <chr> \"Pelagia Alethea Mordoch\", \"Niklaus Oberon\", \"Pela…\n$ `_last_edited_date` <dttm> 2035-01-01, 2035-07-15, 2035-01-01, 2035-01-01, 2…\n$ `_date_added`       <dttm> 2035-01-01, 2035-07-15, 2035-01-01, 2035-01-01, 2…\n$ `_raw_source`       <chr> \"Existing Corporate Structure Data\", \"Oceanus Corp…\n$ `_algorithm`        <chr> \"Automatic Import\", \"Manual Entry\", \"Automatic Imp…\n$ source              <chr> \"Avery Inc\", \"Berger-Hayes\", \"Bowers Group\", \"Bowm…\n$ target              <chr> \"Allen, Nichols and Thompson\", \"Jensen, Morris and…\n$ key                 <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ end_date            <dttm> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…\n```\n:::\n:::\n\n### Changing field name\nIn the code chunk below, `rename()` of **dplyr** package is used to change the following fields that start with “_”.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc3_edges <- mc3_edges %>%\n  rename(\"last_edited_by\" = \"_last_edited_by\",\n         \"last_edited_date\" = \"_last_edited_date\",\n         \"date_added\" = \"_date_added\",\n         \"raw_source\" = \"_raw_source\",\n         \"algorithm\" = \"_algorithm\") \n```\n:::\n\n\nNext, glimpse() function will be used to confirm if the process have been performed correctly.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(mc3_edges)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 75,817\nColumns: 11\n$ start_date       <dttm> 2016-10-29, 2035-06-03, 2028-11-20, 2024-09-04, 2034…\n$ type             <chr> \"Event.Owns.Shareholdership\", \"Event.Owns.Shareholder…\n$ last_edited_by   <chr> \"Pelagia Alethea Mordoch\", \"Niklaus Oberon\", \"Pelagia…\n$ last_edited_date <dttm> 2035-01-01, 2035-07-15, 2035-01-01, 2035-01-01, 2035…\n$ date_added       <dttm> 2035-01-01, 2035-07-15, 2035-01-01, 2035-01-01, 2035…\n$ raw_source       <chr> \"Existing Corporate Structure Data\", \"Oceanus Corpora…\n$ algorithm        <chr> \"Automatic Import\", \"Manual Entry\", \"Automatic Import…\n$ source           <chr> \"Avery Inc\", \"Berger-Hayes\", \"Bowers Group\", \"Bowman-…\n$ target           <chr> \"Allen, Nichols and Thompson\", \"Jensen, Morris and Do…\n$ key              <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ end_date         <dttm> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n```\n:::\n:::\n\n\n### Splitting of words \n\nFrom the screenshot below, we can see that the text in type field are not in a tidy manner.\n\n![](split.png)\nWe are going to tidy the type column by creating two columns as shown below.\n\nFirstly, to split the text in type column into two columns; namely event 1 and event2\n\n\n::: {.cell}\n\n```{.r .cell-code}\nword_list <- strsplit(mc3_edges$type, \"\\\\.\")\n```\n:::\n\n\nThe code chunk below will be used to find the maximum number of elements in any split\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmax_elements <- max(lengths(word_list))\n```\n:::\n\n\nThe code chunk below will be used to pad shorter splits with NA values to make them all the same length.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nword_list_padded <- lapply(word_list, \nfunction(x) c(x, rep(NA, max_elements - length(x))))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nword_df <- do.call(rbind, word_list_padded)\ncolnames(word_df) <- paste0(\"event\", 1:max_elements)\n```\n:::\n\n\nSince the output above is a matrix, the code chunk below is used to convert word_df into a tibble data.frame.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nword_df <- as_tibble(word_df) %>%\n  select(event2, event3)\nclass(word_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"tbl_df\"     \"tbl\"        \"data.frame\"\n```\n:::\n:::\n\n\nNow the extracted columns are appended back into the mc3_edges tibble data.frame\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc3_edges <- mc3_edges %>%\n  cbind(word_df)\n```\n:::\n\n\nTo save mc3_edges into R **rds** file format\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(mc3_edges, \"data/rds/mc3_edges.rds\")\n```\n:::\n\n\n## Wrangling and tidying nodes\n\nIn this section, we will extract and wrangle the nodes object.\n\n### Extracting the nodes data\n\nThe code chunk below will be used to extract the nodes data.frame of mc3 and parses it as a tibble data.frame called mc3_nodes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc3_nodes <- as_tibble(mc3$nodes) %>%\n  distinct()\n```\n:::\n\n\nNext, glimpse() function will be used to confirm if the process have been performed correctly.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(mc3_nodes)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 60,520\nColumns: 15\n$ type                <chr> \"Entity.Organization.Company\", \"Entity.Organizatio…\n$ country             <chr> \"Uziland\", \"Mawalara\", \"Uzifrica\", \"Islavaragon\", …\n$ ProductServices     <chr> \"Unknown\", \"Furniture and home accessories\", \"Food…\n$ PointOfContact      <chr> \"Rebecca Lewis\", \"Michael Lopez\", \"Steven Robertso…\n$ HeadOfOrg           <chr> \"Émilie-Susan Benoit\", \"Honoré Lemoine\", \"Jules La…\n$ founding_date       <chr> \"1954-04-24T00:00:00\", \"2009-06-12T00:00:00\", \"202…\n$ revenue             <dbl> 5994.73, 71766.67, 0.00, 0.00, 4746.67, 46566.67, …\n$ TradeDescription    <chr> \"Unknown\", \"Abbott-Gomez is a leading manufacturer…\n$ `_last_edited_by`   <chr> \"Pelagia Alethea Mordoch\", \"Pelagia Alethea Mordoc…\n$ `_last_edited_date` <chr> \"2035-01-01T00:00:00\", \"2035-01-01T00:00:00\", \"203…\n$ `_date_added`       <chr> \"2035-01-01T00:00:00\", \"2035-01-01T00:00:00\", \"203…\n$ `_raw_source`       <chr> \"Existing Corporate Structure Data\", \"Existing Cor…\n$ `_algorithm`        <chr> \"Automatic Import\", \"Automatic Import\", \"Automatic…\n$ id                  <chr> \"Abbott, Mcbride and Edwards\", \"Abbott-Gomez\", \"Ab…\n$ dob                 <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n```\n:::\n:::\n\n```{mermaid}\nflowchart LR\n  A[Hard edge] --> B(Round edge)\n  B --> C{Decision}\n  C --> D[Result one]\n  C --> E[Result two]\n```\n\n\nVisit [Option](http://datastorm-open.github.io/visNetwork/options.html) to find out more about visOption’s argument.\n\n## Reference\n\n-   Kam, T.S. (2023). [Chapter 27: Modelling, Visualising and Analysing Network Data with R](https://r4va.netlify.app/chap27#overview)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}